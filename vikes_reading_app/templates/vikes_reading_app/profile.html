{% extends 'vikes_reading_app/base.html' %}

{% block title %}Profile - Vike's Reading{% endblock %}

{% block content %}
    {# User Profile Section - Display username and editable bio #}
    <h1>Your Profile</h1>

    <!-- Display the Username -->
    <p><strong>Username:</strong> {{ user.username }}</p>

    {# Messages Section - Display any success or error messages #}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form method="POST" action="{% url 'profile' %}">
        {% csrf_token %}
        <fieldset>
            <legend>Profile Information</legend>
            <div class="form-group">
                <label for="bio">Bio:</label>
                <textarea id="bio" name="bio" rows="4" aria-label="User bio">{{ user.bio }}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </fieldset>
    </form>
    {# Student Progress Section - Shown only for teachers, lists all students and their story progress #}
    {% if students_with_stories %}
        <h2>Your Students</h2>
        {% for entry in students_with_stories %}
            <h3>{{ entry.student.username }}</h3>
            <ul>
                {% for title in entry.story_titles %}
                    <li>{{ title }}</li>
                {% endfor %}
            </ul>
            <a href="{% url 'profile_detail' entry.student.id %}">View Details</a>
            <hr>
        {% endfor %}
    {% endif %}
{% endblock %}